import datetime
import random
import time

import data
from data import answers
greeting_message = '''Ğ¢ĞµĞ±Ğµ Ğ½ÑƒĞ¶Ğ½Ğ° Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ, Ğ´Ğ°? Ğ‘ÑƒĞ´Ñƒ Ñ€Ğ°Ğ´ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ñ‚Ğ²Ğ¾Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹, Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒÑÑ‰Ğ¸Ğ¹ Ñ‚ĞµĞ±Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ¸ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ â¬‡
"ĞĞ±Ñ‰Ğ¸Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹" - Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°Ğ¹ ÑÑ‚Ñƒ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ, ĞµÑĞ»Ğ¸ Ñ‚Ñ‹ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚ Ğ¸Ğ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ğ¸Ğ»Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹, ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ Ğ½Ğ°ÑˆĞ¸Ğ¼ Ğ’Ğ£Ğ—Ğ¾Ğ¼.
"ĞĞ±Ğ¸Ñ‚ÑƒÑ€Ğ¸ĞµĞ½Ñ‚Ñƒ" - Ğ­Ñ‚Ğ¾Ñ‚ Ğ¿ÑƒĞ½ĞºÑ‚ Ñ€Ğ°ÑÑĞºĞ°Ğ¶ĞµÑ‚ Ğ¾ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸ÑÑ… Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸ Ğ’Ğ¾Ñ€Ğ¾Ğ½ĞµĞ¶ÑĞºĞ¾Ğ³Ğ¾ Ğ³Ğ¾ÑÑƒĞ´Ğ°Ñ€ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ½Ğ¸Ğ²ĞµÑ€ÑĞ¸Ñ‚ĞµÑ‚Ğ° Ğ¸Ğ½Ğ¶ĞµĞ½ĞµÑ€Ğ½Ñ‹Ñ… Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¹. ĞÑ‡ĞµĞ½ÑŒ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ ğŸ˜‰
"ĞŸĞ¾ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°Ğ¼ Ğ¼Ğ°Ñ€ĞºĞµÑ‚Ğ¸Ğ½Ğ³Ğ°" - Ğ•ÑĞ»Ğ¸ Ñƒ Ğ’Ğ°Ñ ĞµÑÑ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸ÑĞ¼Ğ¸, Ñ‚Ğ¾ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ ÑÑ‚Ğ¾Ñ‚ Ğ¿ÑƒĞ½ĞºÑ‚ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ°Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ½ĞµĞ³Ğ¾.'''

introductory_student = 'Ğ•ÑÑ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°? Ğ¯ Ğ¿Ğ¾ÑÑ‚Ğ°Ñ€Ğ°ÑÑÑŒ Ñ€Ğ°Ğ·Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒÑÑ. Ğ”Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ Ğ½Ğµ ÑĞ¼Ğ¾Ğ³Ñƒ Ñ‚ĞµĞ±Ğµ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‡ÑŒ, Ñ‚Ğ¾ Ñ‚ĞµĞ±Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€, Ñ ĞµĞ³Ğ¾ Ğ¾Ğ¿Ğ¾Ğ²ĞµÑ‰Ñƒ!'
introductory_entrant = '''ĞŸÑ€ĞµĞºÑ€Ğ°ÑĞ½Ğ¾! Ğ˜Ğ½Ñ‚ĞµÑ€ĞµÑÑƒĞµÑˆÑŒÑÑ Ğ¿Ğ¾ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ² ÑÑ‚Ğ¾Ñ‚ ÑƒĞ½Ğ¸Ğ²ĞµÑ€? Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ Ñ‚ĞµĞ±Ñ ĞµÑÑ‚ÑŒ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³,
Ğ² ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğ¾ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒÑÑ‰Ğ¸Ñ… Ñ‚ĞµĞ±Ñ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ².
ĞĞµ Ğ½Ğ°ÑˆĞµĞ» Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°? ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸ Ğ² Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ´Ğ»Ñ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ¾Ğ², Ñ‚Ğ°Ğ¼ Ñ‚ĞµĞ±Ğµ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚! ("/student_mode")'''
introductory_ad = 'Ğ•ÑĞ»Ğ¸ Ñƒ Ğ²Ğ°Ñ ĞµÑÑ‚ÑŒ Ñ€ĞµĞºĞ»Ğ°Ğ¼Ğ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ÑÑŒĞ±Ğ° Ğ¾ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ - Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ÑÑĞ´Ğ°, Ğ²ÑĞºĞ¾Ñ€Ğµ ÑÑ‚Ğ¾ Ñ€Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ.'
introductory_timetable = 'Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ - ÑÑ‚Ğ¾ Ñ‚Ğ¾ Ñ‡Ñ‚Ğ¾ Ğ½Ğ°Ñ Ğ²ÑĞµÑ… Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµÑ‚! Ğ•ÑĞ»Ğ¸ Ñ‚Ñ‹ Ğ²Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ Ğ² ÑÑ‚Ğ¾Ğ¼ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğµ, Ñ‚Ğ¾ Ğ½Ğ°Ğ¶Ğ¼Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ "Ğ¡Ğ¼ĞµĞ½Ğ° Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸", Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ. Ğ”Ğ»Ñ Ñ‚Ğ¾Ğ³Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ·Ğ°Ğ½ÑÑ‚Ğ¸Ñ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ñ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğ¼ Ñ‚ĞµĞ±Ğµ Ğ´Ğ½ĞµĞ¼ Ğ½ĞµĞ´ĞµĞ»Ğ¸.'

requests_time = {}

# Ğ£Ñ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ
def morning_greeting(first_name):
    greeting_list = [f'Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğµ ÑƒÑ‚Ñ€Ğ¾, Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ¸Ğ»Ğ¸ {first_name}. â°ğŸ¤— ', 'Ğ£Ñ‚Ñ€ĞµÑ‡ĞºĞ° :3\n ', 'ĞŸÑ€ĞµĞºÑ€Ğ°ÑĞ½Ğ¾Ğµ ÑƒÑ‚Ñ€Ğ¾, Ğ½Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ° Ğ»Ğ¸? ğŸŒ ',
    'Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğµ ÑƒÑ‚Ñ€Ğ¾, ÑĞ¾Ğ½Ñ :3\n', 'Ğ›ÑƒÑ‡ÑˆĞµ Ğ±Ñ‹ Ñ€Ğ°Ğ·Ğ¼ÑĞ»ÑÑ, Ğ° Ğ½Ğµ ÑĞ°Ğ´Ğ¸Ğ»ÑÑ ÑÑ€Ğ°Ğ·Ñƒ Ğ·Ğ° ĞºĞ¾Ğ¼Ğ¿ÑŒÑÑ‚ĞµÑ€. ğŸ’ª ', 'Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğµ ÑƒÑ‚Ñ€Ğ¾, ĞºĞ°Ğº Ğ¿Ğ¾Ğ¶Ğ¸Ğ²Ğ°ĞµÑˆÑŒ? ğŸ˜‰ ']
    return greeting_list[random.randint(0, len(greeting_list)-1)]

# Ğ”Ğ½ĞµĞ²Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ
def afternoon_greeting(first_name, day_time):
    greeting_list = [f'Ğ”Ğ¾Ğ±Ñ€Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ, Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ¸Ğ»Ğ¸ {first_name}. ', 'ĞĞ°.. Ğ’Ğ¾Ñ‚ Ñ‚Ñ‹ Ğ³Ğ´Ğµ!) ', 'ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, ĞºĞ°Ğº Ğ¿Ğ¾Ğ¶Ğ¸Ğ²Ğ°ĞµÑˆÑŒ? ',
    'ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, ĞºĞ°Ğº Ğ´ĞµĞ»Ğ°? ğŸ™‡ğŸ”¨ ', 'Ğ—Ğ´Ğ°Ñ€Ğ¾Ğ²Ğ°, Ñ‡ĞµĞ»Ğ¾Ğ²ĞµÑ‡Ğ¸ÑˆĞºĞ°. ğŸ¤– ', f'Ğ¥Ğ¼.. Ğ£Ğ¶Ğµ {day_time} Ñ‡Ğ°ÑĞ¾Ğ². ğŸ˜² ']
    return greeting_list[random.randint(0, len(greeting_list)-1)]

# Ğ’ĞµÑ‡ĞµÑ€Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ
def evening_greeting(first_name):
    greeting_list = ['Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğ³Ğ¾ Ğ²ĞµÑ‡ĞµÑ€Ğ°. ğŸŒ™ğŸŒ  ', 'ĞŸÑ€Ğ¸Ğ²ĞµÑ‚. Ğ”ĞµĞ½ÑŒ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğº ĞºĞ¾Ğ½Ñ†Ñƒ.. ',
    'ĞŸÑ€Ğ¸Ğ²ĞµÑ‚. ĞÑ‚Ğ´Ñ‹Ñ…Ğ°ĞµÑˆÑŒ?\n ', 'ĞĞ°ÑĞ»Ğ°Ğ¶Ğ´Ğ°ÑÑÑŒ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼.. ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! ']
    return greeting_list[random.randint(0, len(greeting_list)-1)]

# ĞĞ¾Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ
def night_greeting(first_name):
    greeting_list = ['ĞĞµ ÑĞ¿Ğ¸Ñ‚ÑÑ, Ğ´Ğ°? ğŸ—¿ ', 'Ğ¢ĞµĞ±Ğµ ÑĞ»ĞµĞ´ÑƒĞµÑ‚ Ğ»ĞµÑ‡ÑŒ Ğ² ĞºÑ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ, Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº. ğŸ¤– ',
    'Ğ”Ğ½ĞµĞ²Ğ½Ğ°Ñ ÑÑƒĞµÑ‚Ğ° Ğ½Ğ¸ĞºĞ°Ğº Ğ½Ğµ Ğ¿Ğ¾ĞºĞ¸Ğ½ĞµÑ‚ Ñ‚Ğ²Ğ¾ĞµĞ³Ğ¾ Ñ‚ĞµĞ»Ğ°? ', f'Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğ¹ Ğ½Ğ¾Ñ‡Ğ¸, {first_name}. ', 'ĞŸÑ€Ğ¸Ğ²ĞµÑ‚. Ğ¡Ğ¾Ğ½ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ²Ğ°Ğ¶ĞµĞ½, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ¿Ğ¾ÑÑ‚Ğ°Ñ€Ğ°Ğ¹ÑÑ Ğ·Ğ°ÑĞ½ÑƒÑ‚ÑŒ ĞºĞ°Ğº Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞºĞ¾Ñ€ĞµĞµ! '
    '1101000010010111110100001011010011010001100000001101000010110000110100001011001011010000101110001101000110001111001000001101000010110110110100001011010111010000101110111101000010110000110100011000111000101100001000001101000010111111110100001011111011010001100000101101000010111110110100001011110011010000101111101101000010111010001000001101000010111110110100001011000111010000101101011101000010110111110100011000110011010001100011111101000010111101\n'
    'Ğ¢ĞµĞ±Ğµ ÑĞ»ĞµĞ´ÑƒĞµÑ‚ Ğ»ĞµÑ‡ÑŒ ÑĞ¿Ğ°Ñ‚ÑŒ, Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº.â° ']
    return greeting_list[random.randint(0, len(greeting_list)-1)]

def random_greeting(first_name):
    day_time = int(datetime.datetime.now().hour)
    if day_time>=5 and day_time<=10:
        return morning_greeting(first_name)
    elif day_time>=11 and day_time<=15:
        return afternoon_greeting(first_name, day_time)
    elif day_time>=16 and day_time<=22:
        return evening_greeting(first_name)
    elif day_time>=23 and day_time<=4:
        return night_greeting(first_name)

def dict_to_list(dictionary): # ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¸Ñ‚ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ² Ğ¼Ğ°ÑÑĞ¸Ğ² Ñ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸
    try:
        return list(dictionary.keys())
    except:
        return list(dictionary)

def in_stream(user_id): # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ĞµÑÑ‚ÑŒ Ğ»Ğ¸ id Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑ Ğ² requests_time. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ bool
    global requests_time
    array = []
    array = dict_to_list(requests_time).copy()
    for element in array:
        if element == user_id:
            return True
    return False

def form_request(user_id, text, users, mode = 'student'):
    if mode == 'student':
        admins = data.student_adm.copy()
        output = {}
        output[user_id] = data.rand_el(data.notification)
        for id in admins:
            output[id] = f'{users.find_value("user_id", user_id)["first_name"]} Ğ·Ğ°Ğ´Ğ°Ğ»(-Ğ°) Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ: "' + text + '"'
    elif mode == 'ad':
        admins = data.marketing_adm.copy()
        output = {}
        output[user_id] = data.rand_el(data.notification)
        for id in admins:
            output[id] = f'{users.find_value("user_id", user_id)["first_name"]} Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµÑ‚: "' + text + '"'
    return output

def find_answer(words):
    keys = dict_to_list(answers).copy()
    answer = []
    for question in keys:
        if len(question - set(words)) == 0:
            answer.append(answers[question])
    if len(answer) != 0:
        return answer
    else:
        return None

def notify_admins(user_id, text, users, mode = 'student'): # Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ² Ğ¾ Ğ¿Ğ¾ÑÑ‚ÑƒĞ¿Ğ¸Ğ²ÑˆĞµĞ¼ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞµ
    global requests_time
    if mode == 'student':
        admins = data.student_adm.copy()
    elif mode == 'ad':
        admins = data.marketing_adm.copy()

    day_time = int(time.time() / 100)
    if in_stream(user_id) == False:
        requests_time[user_id] = day_time
        return form_request(user_id, text, users, mode)
    else:
        t_1 = requests_time[user_id]
        t_2 = day_time
        requests_time[user_id] = day_time
        if (t_2 - t_1) >= 20 or (t_2 - t_1) < 0:
            return form_request(user_id, text, users, mode)
